---
title: "CUBAN MIGRATION ANALYSIS"
author: "Gabriel Hernandez"
date: "2024-03-21"
output: html_document
---
```{r}
#
knitr::opts_chunk$set(comment = "#>", echo = TRUE, fig.width = 6, message = FALSE, results='hide', warnings= FALSE)
#)



#figure settings 
fig_small <- FALSE  # Change to TRUE for smaller figures, FALSE for larger
width_small <- 4    # Width in inches for small figures
width_large <- 8    # Width in inches for large figures
```



```{r install packages, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(classInt)
library(patchwork)
library(mapview)
library(tidycensus)
library(sf)
library(kableExtra)
library(knitr)
library(dplyr)
library(kableExtra)
library(osmdata)
library(ggforce)
library(tigris)
library(flexdashboard)
#library(scales)
library(shiny)
library(stringr)
library(Hmisc)
library(DAAG)
library(car)  #to calculate VIF
library(MASS)
library(rsq)
library(tidyverse)
library(caret)
library(dplyr)


options(scipen=999)
options(tigris_class = "sf")
options(tigris_cache_dir= TRUE)

source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")

#Load API KEY
census_api_key("3aedcfd189958d66a813a29a4b33580e78657644", overwrite = TRUE)
#Set CRS
crs='EPSG:3857'


```
# Introduction

In the past few years 5% of Cuba's 11 million person population was encountered at the U.S. border. Once processed, they begin a process towards becoming permanent residents and they settle in different parts of the United States with permission to work. The purpose of this report is to explore the distribution of the foreign-born Cuban population in the United States. The intention of the following analysis and the resulting interactive map is to provide context and support for the topic of Cuban Migration.

On the other hand, the literature review that I performed led me to consider the importance of remittances to the Cuban economy and their results the in built environment. From personal experience, many Cubans work to send money back home to their families: in small ways like purchasing minutes and data for a phone line, and in big ways like fronting money for renovation materials, installing a new water tank systems, or purchasing a new home altogether. 

I believe that taking stock of the most granular level available through Census data will give interested parties insight into the field of remittance landscapes of Cuba and migratory urbanism. 

If we can accept that places can function as sorting mechanisms for the settlement of peoples, then we can assume that migrants will settle where their network leads them. I take a look at the places where Cubans settle based on and compare metrics such as the total count of housing units, or the gross rent to income ratio. Based on my experience living in America, one's tolerance for how much of your income is used on the rent of land determines the standard of life that you are able to have. Putting myself in my mother's shoes. If I had come to the United States, where could I live and keep more of my income relative to the rent I pay and have housing options. Where could I potentially access my community and have more money to remit?

From a business perspective, the resulting tables and plots offer first steps towards geomarketing campaigns intented to connect to the U.S.-based Cuban community. If someone has a business that, for instance, provides remittance services, it can get its message to the right places more efficiently.  

Lastly, knowing where there have been changes in the population of foreign-born Cubans in the U.S.is useful information for organizations advocate for the Cuban-American vote.

#Data Wrangling

In order to perform the exploratory analysis I will use tidycensus to get data and its associated geometries. I will be operating on three scales: core-based areas, counties, and census tracts. It is important at this point to note that the the Census defines 'foreign-born' populations as 'anyone who is not a U.S. citizen at birth, including those who become U.S. citizens through naturalization.' The subtopics discuss the different scales used in the analysis.

I compiled a list of variables for 2009 and 2022 ACS 5-Year Estimates. The codes differ between years so they were created from carefully reading load_variable() and filtering the outputs on R Studios interactive view(). 

```{r ACS LOAD VARIABLES, echo=FALSE}
# vars for 2009 and 2022 for change over time comparison

acs_variable_list.2009 <- load_variables(2009, #year
                                         "acs5", #five year ACS estimates
                                         cache = TRUE)

acs09_vars <- c("B06003_013E", #Foreign Born - PLACE OF BIRTH BY SEX IN THE UNITED STATES
              "B05002_013E", #Estimate!!Total!!Foreign born - PLACE OF BIRTH BY CITIZENSHIP STATUS
              "B05007_039E", #Estimate!!Total!!Latin America!!Caribbean!!- Entered before 1980
              "B25002_003E", #stimate!!Total!!Vacant OCCUPANCY STATUS
              "B09016_002E", #Estimate!!Total!!In households - HOUSEHOLD TYPE (INCLUDING LIVING ALONE) BY RELATIONSHIP
              "B19013_001E", #Estimate!!Median household income in the past 12 months (in 2009 inflation-adjusted dollars)
              "B19037A_053E", #Estimate!!Total!!Householder 65 years and over
              "B06012_002E", #Total!!Below 100 percent of the poverty level
              "B25071_001E", #Median gross rent as a percentage of household income
              "B25035_001E", #Median year structure built
              "B19057_001E", #Total - PUBLIC ASSISTANCE INCOME IN THE PAST 12 MONTHS FOR HOUSEHOLDS
              "B25001_001E", #Total HOUSING UNITS
              "B05006_127E", #Total!!Americas!!Latin America!!Caribbean!!Cuba
              "B25077_001E") #med values

acs22load <- load_variables(2022, "acs5", cache = TRUE)
acs22_vars <-c("B06012PR_002E", #Tot Below 100 percent of the poverty level
               "B25002_003E", #TotalVacant
               "B21004_001E", #Median income in the past 12 months (in 2022 inflation-adjusted dollars
               "B09021_023E", #65 years and over Lives alone
               "B25136_001E", #Total Housing Units
               "B25071_001E", #Median gross rent as a percentage of household income
               "B05006_143E", #Total:!!Americas:!!Latin America:!!Caribbean:!!Cuba
               "B19057_002E", #Total:!!With public assistance income
               "B25035_001E", #Median year structure built
               "B25077_001E" #med values
       )



```
## Core-Based Statistical Areas: ACS 5-Year Estimates 2022

A metropolitan or micropolitan statistical area contains a core area with a substantial population nucleus, as well as adjacent communities having a high degree of economic and social integration with that core. Core Based Statistical Area (CBSA) term became effective in 2000 and refers collectively to metropolitan and micropolitan statistical areas.Each metropolitan statistical area must have one urbanized area of 50,000 or more inhabitants. Each micropolitan statistical area must have one urban cluster of 10,000 to 49,999 inhabitants

The first call is to get the core-based statistical areas across the United States using ACS 5- Year Estimates for 2022, to observe the count of foreign-born Cubans in each area as well as other variables that I was interested in. 

I then filter the data frame that it creates in different ways to create subsets that provide context to the existing presence of Cuban migrants. First, I isolate metro and micro statistical areas, as they are both returned in the call. I use filter() on metro areas to get those that have 1000+ foreign born cubans, and 100+ for micro areas. Lastly, because the majority of the Cuban migration is related to Florida, I further filtered the USA_metro and USA_micro objects to those that are in Florida and outside of it. I believe this will provide more unknown context to the general story of Cuban Migration. 

```{r CBA OBJECTS , echo=TRUE}

#get variables in core_based_statistical areas across USA

USA_allcba <- get_acs(geography = "metropolitan statistical area/micropolitan statistical area",
                             year = 2022, 
                             variables = acs22_vars, 
                             geometry = TRUE, 
                             output = "wide") 

#Rename the variables for the 2022 data
USA_allcba <- USA_allcba %>%
         rename(total_below_pov=B06012PR_002E,
         tot_vacant22 = B25002_003E,
         med_inc22 = B21004_001E,
         up65_alone22 = B09021_023E,
         tot_housingunits22 =B25136_001E,
         gross_v_inc_perc22 = B25071_001E,
         tot_fb_cuba22 = B05006_143E,
         tot_pa_inc22 = B19057_002E,
         med_yb22 = B25035_001E,
         med_values22 = B25077_001E)%>%
  mutate(vacpct22 = (tot_vacant22/tot_housingunits22)) %>%
  st_as_sf(crs = crs)

#Begin filtering
USA_micros <- USA_allcba %>%
              filter(grepl("Micro", NAME, ignore.case = TRUE)) %>%
              dplyr:: select(NAME, GEOID,tot_housingunits22,gross_v_inc_perc22,tot_fb_cuba22,med_yb22, vacpct22) %>%
              filter(tot_fb_cuba22 >= 100)%>%
              arrange(desc(tot_fb_cuba22))

USA_metros <- USA_allcba %>%
             dplyr:: filter(grepl("Metro", NAME, ignore.case=TRUE)) %>%
             dplyr:: select(NAME, GEOID,tot_housingunits22,gross_v_inc_perc22,tot_fb_cuba22,med_yb22, vacpct22) %>%
              filter(tot_fb_cuba22 >= 1000)%>%
              arrange(desc(tot_fb_cuba22))

#create final objects for kable tables
noFL_micros <- USA_micros %>%
              filter(!grepl("FL M", NAME, ignore.case = TRUE)) 
            

noFL_metros <-USA_metros %>%
              filter(!grepl("FL M" , NAME, ignore.case= TRUE))

fl_micros <- USA_micros %>%
             filter(grepl("FL M", NAME, ignore.case = TRUE)) 
            

fl_metros <-USA_metros %>%
            filter(grepl("FL M" , NAME, ignore.case= TRUE))
            

```


## County Data and Calculating Change over Time

#####start here####
to get the data we need on foreign-born cubans at the county level in order to identify, outside of florida, what are the counties with the current highest concentration of foreign-born Cubans. I will also use tigris to get an sf object of "places" in the united states. The goal is to identify counties of interest and create an sf object from intersecting those counties and the places object of all cities in the United states.

Furthermore, at the end of the county-level analysis, a call will be made to tigris to get the census tracts for the counties of interest in order to join them to the dataframe with the change-over-time values. THis will be for the main visualization: an interactive map that displays first the location of counties of interest and then upon zooming in, the boundaries of the places that they are in and the census tract level data displaying where in the counties the cuban communities are relative to the city boundaries. (relate this to theory about settlement patterns of immigrants). 
```{r COUNTY OBJECTS , echo=TRUE, warning=FALSE}

USA_2009 <- get_acs(geography = "county",
                             year = 2009, 
                             variables = acs09_vars,
                             geometry = TRUE, 
                             output = "wide") 
USA_2009 <- USA_2009 %>%
          rename(
          fb_placebysex.2009 = B06003_013E,
          totalfb_placebycitizenshipstatus.2009 = B05002_013E,
          total_carib_1980.2009 = B05007_039E,
          total_vacancy_O_status.2009 = B25002_003E,
          total_householdtype_relationship.09 = B09016_002E,
          med_hh_inc.09 = B19013_001E,
          hh_65up.09 = B19037A_053E,
          Total_b_100pov.09 = B06012_002E,
          gross_v_income_percentage.09 = B25071_001E,
          med_built_year.09 = B25035_001E,
          tot_publicass_inc.09 = B19057_001E,
          tot_housingunits.09 = B25001_001E,
          cub_fb_total09 = B05006_127E,
          med_houseval09 = B25077_001E
          )%>%
          mutate(vacancyPct.2009 = total_vacancy_O_status.2009/tot_housingunits.09) %>% # Get Vacanct Rate
          st_as_sf(crs = crs)

USA_2022 <- get_acs(geography = "county",
                             year = 2022, 
                             variables = acs22_vars, 
                             geometry = TRUE, 
                             output = "wide") 
USA_2022 <- USA_2022 %>%
         rename(
         tot_below100pov22 = B06012PR_002E,
         tot_vacant22 = B25002_003E,
         med_inc22 = B21004_001E,
         up65_alone22 = B09021_023E,
         tot_housingunits22 =B25136_001E,
         gross_v_inc_perc22 = B25071_001E,
         tot_fb_cuba22 = B05006_143E,
         tot_pa_inc22 = B19057_002E,
         med_yb22 = B25035_001E,
         med_values22 = B25077_001E)%>%
  mutate(vacpct22 = (tot_vacant22/tot_housingunits22)) %>%
  st_as_sf(crs = crs)

#Merge the dataframes

USA0922_df <- st_drop_geometry(USA_2022,USA_2009)%>%
         left_join(USA_2009 , USA_2022, by= c("GEOID"))%>%
         mutate(change_vac_pct = vacpct22 - vacancyPct.2009,
           change_med_inc = med_inc22 - med_hh_inc.09,
           change_med_values = med_values22 - med_houseval09,
           change_count_housingunits= tot_housingunits22-tot_housingunits.09,
           change_cuba_fb = tot_fb_cuba22 - cub_fb_total09,
           change_pct_below100pov = tot_below100pov22 - Total_b_100pov.09)

#Begin Filtering Process of COUNTIES THAT MEET DOUBLE CRITERIA

##decrease
USA0922_df_filtered_decrease <- USA0922_df %>%
              dplyr:: filter(change_cuba_fb < -500)%>%
              dplyr:: select(NAME.x, GEOID, geometry,cub_fb_total09, med_inc22,up65_alone22, tot_housingunits22,   gross_v_inc_perc22, change_count_housingunits, tot_pa_inc22,med_values22, vacpct22, change_med_values,change_cuba_fb, change_med_inc,                         change_vac_pct)

##increase
USA0922_df_filtered_increase <- USA0922_df %>% 
     dplyr::  filter(change_cuba_fb > 500) %>%
     dplyr::  select(NAME.x, GEOID, geometry, med_inc22,up65_alone22,cub_fb_total09, tot_housingunits22, gross_v_inc_perc22,   change_count_housingunits,                              tot_pa_inc22,med_values22, vacpct22, change_med_values, change_med_inc,                         change_vac_pct,change_cuba_fb)
  
#Combine the two dfs to create the filtered all counties object that will be used for the census tract level selected counties pull

change_fbcuban0922<- rbind(USA0922_df_filtered_decrease, USA0922_df_filtered_increase)%>%
  st_as_sf(crs = crs)




```

## Functions to Process the Selected Counties as inputs for their Census Tract Level Data

Upon analyzing the counties I chose using plus/minus 500 foreign born cubans as the cutoff for both decreasing and increasing changes in foreign born Cuban counts. I created an sf object of counties that between 2009-2022 had either lost or absorbed 500 foreign-born Cubans. I then used this as the input for an iterative call to get their census tract level data. 

It is at this level that I desired to create the interactive map below. 


It shows the census tract level data for the filtered counties. For additional context, I wanted to add another layer and see the presence of Cubans relative to the boundaries and centers of metropolitan/micropolitan areas. 

### Processing Name Column to create columns with the County and State Arguments 

The chunk below shows the two main things neccesary to transform the 'Name' column in county-level get_acs() output  to iterate those counties back into a new call for their respective census-tract data. 


```{r COUNTY TO TRACT , echo=TRUE}

split_county_state <- function(name) {
  # Split the string on the comma to separate county and state
  parts <- str_split(name, pattern = ",", n = 2, simplify = TRUE)
  county <- trimws(parts[1])
  state <- trimws(parts[2])

  return(list(county = county, state = state))
}

clean_county_name <- function(county_name) {
  # Remove 'County' from the end of the string and any leading/trailing spaces
  cleaned_name <- sub("County$", "", county_name)
  cleaned_name <- trimws(cleaned_name)
  return(cleaned_name)
}



#apply the function to get the split vectors of 'county' and 'state' arguments for the 

change_fbcuban0922_split <- change_fbcuban0922 %>%
  mutate(
    split_data = map(NAME.x, split_county_state),
    County = map_chr(split_data, "county"),
    State = map_chr(split_data, "state")
  ) %>%
 dplyr::  select(-split_data)%>%
  mutate(cleaned_County = sapply(County, clean_county_name))# Remove the list column after extracting components

```
### Function Takes New Columns, Performs API Call, Combines Each output Into One Object

The following chunk of code creates the iterative functions that will take a 'county' and 'state' column and run a get_acs() tidy census call for both 2009 and 2022. The variables are different each year so they have to be done separately. 

```{r ITERATE GETACS FUNCTION, echo=TRUE}

iterate_county22 <- function(df) {
  # List to store the results
  results_list <- list()

  # Loop over each row of the dataframe
  for (i in 1:nrow(df)) {
    # Extract county and state from the current row
    County <- df$cleaned_County[i]
    State <- df$State[i]
    
    # Try to fetch ACS data, handling errors
    acs_data <- tryCatch({
      get_acs(
        geography = "tract",  # Make sure geography is correctly specified
        variables = "B05006_143E",  # Example variable: Total Population
        state = State,
        county = County,
        year = 2022,
        survey = "acs5",
        geometry = TRUE
      )
    }, error = function(e) {
      message("Failed for ", County, ", ", State, ": ", e$message)
      NULL  # Return NULL on failure
    })
    
    # Append the fetched data to the list, if not NULL
    if (!is.null(acs_data)) {
      results_list[[length(results_list) + 1]] <- acs_data
    }
  }

  # Combine all the results into one data frame
  final_data <- bind_rows(results_list)
  return(final_data)
}

iterate_county09 <- function(df) {
  # List to store the results
  results_list <- list()

  # Loop over each row of the dataframe
  for (i in 1:nrow(df)) {
    # Extract county and state from the current row
    County <- df$cleaned_County[i]
    State <- df$State[i]
    
    # Try to fetch ACS data, handling errors
    acs_data <- tryCatch({
      get_acs(
        geography = "tract",  # Make sure geography is correctly specified
        variables = "B05006_127E",  # Example variable: Total Population
        state = State,
        county = County,
        year = 2009,
        survey = "acs5",
        geometry = TRUE
      )
    }, error = function(e) {
      message("Failed for ", County, ", ", State, ": ", e$message)
      NULL  # Return NULL on failure
    })
    
    # Append the fetched data to the list, if not NULL
    if (!is.null(acs_data)) {
      results_list[[length(results_list) + 1]] <- acs_data
    }
  }

  # Combine all the results into one data frame
  final_data <- bind_rows(results_list)
  return(final_data)
}

```
### Applying the Function Create 2009 and 2022 Objects
```{r , results='hide', echo=TRUE, message=FALSE, warning= FALSE}

final_acs09_data <- iterate_county09(change_fbcuban0922_split)
final_acs22_data <- iterate_county22(change_fbcuban0922_split)
```
### Transforming Tract Data and Calculating The Change In Foreign Born Cubans
```{r Transforming Cen}

final_acs09_data<-final_acs09_data %>%
                  rename(cub_fb_total09 = estimate)

final_acs22_data<- final_acs22_data %>%
                  rename(tot_fb_cuba22 = estimate)

final_viz_change <- st_drop_geometry(final_acs09_data) %>%
 dplyr::  select(GEOID, cub_fb_total09) %>%  # Select only the columns needed for computing change
  left_join(final_acs22_data, by = "GEOID") %>%
  mutate(change_cuba_fb = tot_fb_cuba22 - cub_fb_total09)

#dropNA values in change, won't visualize.
final_viz_change_droppedNA <- final_viz_change[!is.na(final_viz_change$change_cuba_fb), ]


#Add Geometry back
final_viz_change_droppedNA<- final_viz_change_droppedNA%>%
                             st_as_sf(sf_column_name='geometry')
```
### Intersect All-USA Core-Based Areas SF Object To Get Boundaries

The chunk below intersects the selected counties object, the same one used to perform the census-tract level object, with the US-wide metropolitan and micropolitan boundaries object introduced at the beginning of the analysis. Again, this is done to show the boundaries on the interactive map for more context. 

```{r}
#we are going to intercect all metro and micro areas with the selected counties object 'change_fbcuban0922'


metro_micro_boundaries_final <-USA_allcba%>%
                     
                     st_as_sf()%>%
                     st_transform(st_crs(change_fbcuban0922))
                     st_intersection(change_fbcuban0922)


```
## Data Analysis

### 



#Results

## Census Tract Level Interactive Map

**add the boundaries layer to this

```{r echo=TRUE}
# Install (if necessary) and load the tmap package
if (!requireNamespace("tmap", quietly = TRUE)) {
    install.packages("tmap")
}
library(tmap)
library(dplyr)
library(sf)
tmap_options(check.and.fix = TRUE)

# Set tmap mode to interactive viewing
tmap_mode("view")

final_viz_change_droppedNA<-final_viz_change_droppedNA%>%
  st_as_sf()
# Create the map
tm <- tm_shape(final_viz_change_droppedNA) +  # Adds the 'final' object
     tm_polygons("change_cuba_fb", breaks = c(-1015, -500,0, 500, 1847), title = "Change in Count of Foreign Born Cubans", 
                palette = "-RdYlBu",  # Color palette  
                alpha=0.4,
                border.col = "black",  # Border color for polygons in 'final'
                border.alpha = 0.3)+ # Border transparency
   tm_text('change_cuba_fb')+
   tm_basemap("Esri.WorldStreetMap")
# Adding another layer with 'metro_micro_areas'

# <- tm + tm_shape(metro_micro_boundaries_final) +
        #   tm_borders(col = "red", lwd = .5, alpha = 0.3)  # Customize the boundary style

# Print the map
tm



```
## Metropolitan / Micropolitan Analysis

### Summary Statistics

#### Metropolitan Areas Outside of Florida

Median count total housing units: 1026146
:Average rent v income perc - 30.0`%
MEDIAN COUNT fb cuban - 2054
mean year structure built: 1980

#### Metropolitan Areas in Florida

Median count total housing units: 260981
:Average rent v income perc - 33.08`%
MEDIAN COUNT fb cuban - 4322
mean year structure built: 1989

#### Micropolitan Areas in Florida

Median count total housing units: 18496
:Average rent v income perc - 31.49
MEDIAN COUNT fb cuban - 251
mean year structure built: 1986

#### Micropolitan Areas Outside of Florida

Median count total housing units: 17833
:Average rent v income perc - 25.81%
MEDIAN COUNT fb cuban - 160
mean year structure built: 1976

###Regressions

The results of the regressions below lack predictive power. When the total count of housing units shows up as a significant predictor (p-value < 0.001), it does not make a major difference in the count of foreign born Cubans. The analysis would benefit from removing outliers, and ultimately it is limited by the count of observations. 

#### Outside of Florida: Metropolitan Areas Regression

The total Count of Housing Units was a significant predictor until I removed the New York/Newark metropolitan area from the model's observations. Even then, it did not make significant change in the count per unit of housing increased (less than a person).

Below is a scatter plot showing that the majority of metropolitan areas outside of Florida where there are cubans have less than 3 million housing units. 
```{r , noFL_Metros Regression}
#remove outlier (NY NJ) for better scatterplot of housing units

noFL_metros<- noFL_metros%>%
  filter(!str_detect(NAME, 'New York'))

noFL_metro_fit <- lm(tot_fb_cuba22 ~ tot_housingunits22 + gross_v_inc_perc22+  med_yb22, data=noFL_metros)
summary(noFL_metro_fit)

plot(noFL_metros$tot_fb_cuba22, noFL_metros$tot_housingunits22)


```


#### Florida: Metropolitan Areas Regression

When it comes to Florida, I removed Tampa and Miami outliers and ran the same regression. The adjusted R square was .74, suggesting a strong model with the few variables that we have. Again, the only strong predictor was housing units (p-value <0.0001) but the unit increase only altered the count of foreign born Cubans by less than a person.

Below is a scatterplot of the Total count of Housing units and the total count of foreign born Cubans. 

```{r , FL_Metros Regression}

#filter out Miami for scatterplot
fl_metros<- fl_metros%>%
  filter(!str_detect(NAME, c('Miami|Tampa')))

fl_metros_fit <- lm(tot_fb_cuba22 ~ tot_housingunits22 + gross_v_inc_perc22 + med_yb22, data=fl_metros)
summary(fl_metros_fit)
plot(fl_metros$tot_fb_cuba22, fl_metros$tot_housingunits22)


```



#### Outside of Florida: Micropolitan Areas 

The resulting regression did not return any strong predictors. This could be due to the distribution of the data, seen below. This makes sense given that we are talking about micropolitan areas. My theory is that the decision to settle in these areas is due to factors that would require deeper investigation than one using Census data. They may be more nuanced and network-related. Interviews and oral histories would best shed light on this aspect of the Cuban migration story.

```{r , noF_Micros Regression}

noFl_micro_fit <- lm(tot_fb_cuba22 ~ tot_housingunits22 + gross_v_inc_perc22 + med_yb22, data=noFL_micros)
hist(noFL_micros$tot_housingunits22)



```


#### Florida: Micropolitan Areas Regression

There are too few observations to make any meaningful statistical inferences. However, again it would be wise to take the table of these areas and investigate deeper the roots of their cuban communities.

```{r , FL_Micros Regression}

Florida_micros_fit <- lm(tot_fb_cuba22 ~ tot_housingunits22 + gross_v_inc_perc22 + med_yb22, data=fl_micros)
summary(Florida_micros_fit)
hist(fl_micros$tot_housingunits22)


```
### Tables

The following tables show the markets that remained when I applied previously described filters to the metro/micropolitan areas of the United States. I have sorted them firstly using the the highest count of Cubans, then the lowest Gross Rent to Income Ratio, and lastly the highest count of housing units.

#### Florida Metropolitan Core-Based Areas

```{r , kable table 1}

# Sorting the data
fl_metros_sorted <- fl_metros %>%
  dplyr::arrange(desc(tot_fb_cuba22))

# Creating the table with kable and kableExtra

fl_metro_kable <- fl_metros_sorted %>%
  kable("html", table.attr = "style='width:100%;'") %>%
  kable_styling(
    full_width = FALSE, 
    position = "center",
    font_size = 12
  ) %>%
  column_spec(1, bold = TRUE, color = "red") %>%
  column_spec(2, background = "#FFF2CC") %>%
  column_spec(3, italic = TRUE)

# Print the table to view in an RMarkdown output or similar
fl_metro_kable


```



#### Florida Micropolitian Core- Based Areas


```{r , kable table 2}

# Sorting the data
fl_micros_sorted <- fl_micros %>%
  dplyr::arrange(desc(tot_fb_cuba22), gross_v_inc_perc22, desc(tot_housingunits22 ))


```


#### Outside of Florida Metropolitan Core-Based Areas


```{r , kable table 3}


# Sorting the data
noFL_metros_sorted <- noFL_metros %>%
  dplyr::arrange(desc(tot_fb_cuba22), gross_v_inc_perc22, desc(tot_housingunits22 ))

```


#### Outside of Florida Micropolitan Core-Based Areas


```{r , kable table 4}

# Sorting the data
noFL_micros_sorted <- noFL_micros %>%
  dplyr::arrange(desc(tot_fb_cuba22), gross_v_inc_perc22, desc(tot_housingunits22 ))


```




## Does the 2009 count of foreign born cubans correlate with the observed changes in the data?
###County LEvel
```{r r2 Migration, echo=TRUE}



final_viz_change_droppedNA

```

#Discussion and Conclusion

discuss transnational gentrification***